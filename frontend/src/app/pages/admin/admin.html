<!-- Admin Header -->
<div class="admin-header">
  <div class="admin-container">
    <div class="admin-header-content">
      <div>
        <h1><i class="fas fa-building"></i> Painel Administrativo</h1>
        <p>Gerenciamento de Imóveis - Alancarmo Corretor</p>
      </div>
      <button class="btn btn-danger" (click)="logout()">
        <i class="fas fa-sign-out-alt"></i> Sair
      </button>
    </div>
  </div>
</div>

<!-- Main Container -->
<div class="admin-container">

  <!-- Stats Section -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon blue"><i class="fas fa-building"></i></div>
      <div class="stat-value">{{ stats.total }}</div>
      <div class="stat-label">Total de Imóveis</div>
    </div>

    <div class="stat-card">
      <div class="stat-icon green"><i class="fas fa-check-circle"></i></div>
      <div class="stat-value">{{ stats.available }}</div>
      <div class="stat-label">Disponíveis</div>
    </div>

    <div class="stat-card">
      <div class="stat-icon orange"><i class="fas fa-star"></i></div>
      <div class="stat-value">{{ stats.featured }}</div>
      <div class="stat-label">Em Destaque</div>
    </div>

    <div class="stat-card">
      <div class="stat-icon red"><i class="fas fa-handshake"></i></div>
      <div class="stat-value">{{ stats.sold }}</div>
      <div class="stat-label">Vendidos</div>
    </div>
  </div>

  <!-- Actions -->
  <div class="actions">
    <button
      class="btn btn-primary mb-3"
      data-bs-toggle="modal"
      data-bs-target="#propertyModal">
      + Novo Imóvel
    </button>
  </div>

  <!-- MODAL -->
  <div class="modal fade" id="propertyModal" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">

        <div class="modal-header">
          <h2 class="modal-title">
            <i class="fas fa-edit"></i>
            {{ editingId ? 'Editar Imóvel' : 'Novo Imóvel' }}
          </h2>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">

          <form (ngSubmit)="saveProperty()" class="property-form">
            <div class="form-grid">

              <div class="form-group full-width">
                <label>Título *</label>
                <input type="text" [(ngModel)]="formData.title" name="title" required>
              </div>

              <div class="form-group full-width">
                <label>Descrição *</label>
                <textarea rows="4" [(ngModel)]="formData.description" name="description" required></textarea>
              </div>

              <div class="form-group">
                <label>Preço *</label>
                <input
                  type="text"
                  [value]="rawValues.price"
                  (input)="rawValues.price = $event.target.value"
                  (blur)="applyCurrencyFormat('price')"
                  (focus)="selectAll($event)"
                  placeholder="R$ 0,00">
              </div>

              <div class="form-group">
                <label>CEP</label>
                <input type="text" [(ngModel)]="formData.zipCode" name="zipCode" (blur)="lookupCEP()">
              </div>

              <div class="form-group">
                <label>Condomínio</label>
                <input
                  type="text"
                  [value]="rawValues.condoFee"
                  (input)="rawValues.condoFee = $event.target.value"
                  (blur)="applyCurrencyFormat('condoFee')"
                  (focus)="selectAll($event)">
              </div>

              <div class="form-group">
                <label>IPTU</label>
                <input
                  type="text"
                  [value]="rawValues.iptu"
                  (input)="rawValues.iptu = $event.target.value"
                  (blur)="applyCurrencyFormat('iptu')"
                  (focus)="selectAll($event)">
              </div>

              <div class="form-group full-width">
                <label>Condomínio inclui</label>
                <input type="text" [(ngModel)]="formData.condoIncludes" name="condoIncludes">
              </div>

              <div class="form-group">
                <label>Tipo *</label>
                <select [(ngModel)]="formData.type" name="type" required>
                  <option value="">Selecione</option>
                  <option>Casa</option>
                  <option>Apartamento</option>
                  <option>Terreno</option>
                  <option>Comercial</option>
                  <option>Rural</option>
                </select>
              </div>

              <div class="form-group">
                <label>Rua</label>
                <input type="text" [(ngModel)]="formData.street" name="street">
              </div>

              <div class="form-group">
                <label>Bairro</label>
                <input type="text" [(ngModel)]="formData.neighborhood" name="neighborhood">
              </div>

              <div class="form-group">
                <label>Cidade</label>
                <input type="text" [(ngModel)]="formData.city" name="city">
              </div>

              <div class="form-group">
                <label>Estado</label>
                <input type="text" maxlength="2" [(ngModel)]="formData.state" name="state">
              </div>

              <div class="form-group">
                <label>Quartos</label>
                <app-custom-dropdown
                  label="{{ formData.bedrooms ? formData.bedrooms + '+' : 'Qualquer' }}"
                  icon="fas fa-bed"
                  [value]="formData.bedrooms"
                  [items]="[
                    { label: 'Qualquer', value: undefined },
                    { label: '1+', value: 1 },
                    { label: '2+', value: 2 },
                    { label: '3+', value: 3 },
                    { label: '4+', value: 4 }
                  ]"
                  (valueChange)="formData.bedrooms = $event">
                </app-custom-dropdown>
              </div>

              <div class="form-group">
                <label>Banheiros</label>
                <app-custom-dropdown
                  label="{{ formData.bathrooms ? formData.bathrooms + '+' : 'Qualquer' }}"
                  icon="fas fa-bath"
                  [value]="formData.bathrooms"
                  [items]="[
                    { label: 'Qualquer', value: undefined },
                    { label: '1+', value: 1 },
                    { label: '2+', value: 2 },
                    { label: '3+', value: 3 }
                  ]"
                  (valueChange)="formData.bathrooms = $event">
                </app-custom-dropdown>
              </div>

              <div class="form-group">
                <label>Área</label>
                <input type="number" [(ngModel)]="formData.area" name="area">
              </div>

              <div class="form-group">
                <label>Vagas</label>
                <app-custom-dropdown
                  label="{{ formData.parking ? formData.parking + '+' : 'Qualquer' }}"
                  icon="fas fa-car"
                  [value]="formData.parking"
                  [items]="[
                    { label: 'Qualquer', value: undefined },
                    { label: '1+', value: 1 },
                    { label: '2+', value: 2 },
                    { label: '3+', value: 3 }
                  ]"
                  (valueChange)="formData.parking = $event">
                </app-custom-dropdown>
              </div>

              <div class="form-group">
                <label>Contato *</label>
                <input type="text" [(ngModel)]="formData.contact" name="contact" required>
              </div>

              <div class="form-group">
                <label><input type="checkbox" [(ngModel)]="formData.featured" name="featured"> Destaque</label>
              </div>

              <div class="form-group">
                <label><input type="checkbox" [(ngModel)]="formData.sold" name="sold"> Vendido</label>
              </div>

              <div class="form-group full-width">
                <label>Imagens</label>
                <input type="file" multiple (change)="onFileSelected($event)">
              </div>

            </div>

            <div class="form-actions">
              <button type="submit" class="btn btn-success" [disabled]="saving">
                <i class="fas" [class.fa-save]="!saving" [class.fa-spinner]="saving" [class.fa-spin]="saving"></i>
                {{ saving ? 'Salvando...' : 'Salvar' }}
              </button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                Cancelar
              </button>
            </div>

          </form>

        </div>
      </div>
    </div>
  </div>

<div *ngIf="!loading && properties.length > 0" class="table-responsive">
      <table class="properties-table">
        <thead>
          <tr>
            <th>Imagem</th>
            <th>Título</th>
            <th>Tipo</th>
            <th>Preço</th>
            <th>Status</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let property of properties">
            <td>
              <img 
                *ngIf="property.imageUrls && property.imageUrls.length > 0" 
                [src]="property.imageUrls[0]" 
                alt="Imagem"
                class="table-img">
              <i *ngIf="!property.imageUrls || property.imageUrls.length === 0" class="fas fa-image"></i>
            </td>
            <td>
              {{ property.title }}
              <span *ngIf="property.featured" class="badge badge-star">
                <i class="fas fa-star"></i> Destaque
              </span>
            </td>
            <td>{{ property.type }}</td>
            <td>R$ {{ formatPrice(property.price) }}</td>
            <td>
              <span class="badge" [class.badge-success]="!property.sold" [class.badge-danger]="property.sold">
                {{ property.sold ? 'Vendido' : 'Disponível' }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button class="btn btn-sm btn-primary" (click)="editProperty(property)">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-danger" (click)="deleteProperty(property.id)">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
</div>
