<div class="property-detail-container">

  <!-- Loading -->
  <div *ngIf="loading" class="state state-loading">
    <i class="fas fa-spinner fa-spin"></i>
    <p>Carregando imóvel...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error && !loading" class="state state-error">
    <i class="fas fa-exclamation-triangle"></i>
    <h2>Imóvel não encontrado</h2>
    <button class="btn-primary" (click)="goBack()">
      Voltar
    </button>
  </div>

  <!-- Content -->
  <div *ngIf="property && !loading">

    <a class="back-button" (click)="goBack()">
      <i class="fas fa-arrow-left"></i> Voltar
    </a>

    <!-- HEADER -->
    <header class="property-header">
      <h1>{{ property.title }}</h1>

      <div class="price">R$ {{ formatPrice(property.price) }}</div>
      <div class="extra-costs" *ngIf="property.condoFee || property.iptu">
        <span class="price" style="font-size: .8rem;" *ngIf="property.condoFee">
          Condomínio: R$ {{ formatPrice(property.condoFee) }}
        </span>
        <br>
        <span class="price" style="font-size: .8rem;" *ngIf="property.iptu">
          IPTU anual: R$ {{ formatPrice(property.iptu) }}
        </span>
      </div>

      <div class="location">
        <i class="fas fa-map-marker-alt"></i> {{ getLocation() }}
      </div>

      <div class="quick-info">
        <span *ngIf="property.bedrooms"><i class="fas fa-bed"></i> {{ property.bedrooms }} quartos</span>
        <span *ngIf="property.bathrooms"><i class="fas fa-bath"></i> {{ property.bathrooms }} banheiros</span>
        <span *ngIf="property.area"><i class="fas fa-ruler-combined"></i> {{ property.area }} m²</span>
        <span *ngIf="property.parking"><i class="fas fa-car"></i> {{ property.parking }} vagas</span>
      </div>

      <div class="badges">
        <span *ngIf="property.featured" class="badge featured">Destaque</span>
        <span *ngIf="property.sold" class="badge sold">Vendido</span>
        <span *ngIf="!property.sold" class="badge available">Disponível</span>
      </div>
    </header>

    <!-- GALLERY -->
    <!-- <section *ngIf="images.length" class="gallery">
      <div class="gallery-main">
        <img [src]="currentImage" [alt]="property.title">

        <button *ngIf="images.length > 1" class="nav prev" (click)="prevImage()">
          <i class="fas fa-chevron-left"></i>
        </button>
        <button *ngIf="images.length > 1" class="nav next" (click)="nextImage()">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>

      <div *ngIf="images.length > 1" class="thumbs">
        <img
          *ngFor="let img of images; let i = index"
          [src]="img"
          [class.active]="i === currentImageIndex"
          (click)="selectImage(i)"
        />
      </div>
    </section> -->

  <div class="property-gallery" *ngIf="images?.length">

    <!-- SWIPER PRINCIPAL -->
    <swiper-container
      #gallerySwiper
      class="property-gallery-swiper"
      slides-per-view="1"
      space-between="16"
      loop="false"
      (swiperslidechange)="onSlideChange()"
    >
      <swiper-slide *ngFor="let img of images; let i = index">
        <div class="image-wrapper">
          <img
            [src]="img"
            class="gallery-image"
            alt="Imagem do imóvel"
            (click)="openImageViewer(img)"
          />
          <div class="zoom-overlay">
            <i class="fas fa-search-plus"></i>
          </div>
        </div>
      </swiper-slide>
    </swiper-container>


    <!-- THUMBS (IGUAL ANTES) -->
    <div class="thumbs" *ngIf="images.length > 1">
      <img
        *ngFor="let img of images; let i = index"
        [src]="img"
        [class.active]="i === currentImageIndex"
        (click)="goToSlide(i)"
      />
    </div>

  </div>

    <!-- GRID -->
    <div class="content-grid">

      <!-- MAIN -->
      <main class="main-info">

        <section class="ideal-for">
          <h3>Este imóvel é ideal para</h3>
          <p>
            Quem busca conforto, boa localização e segurança, com fácil acesso
            aos principais pontos da cidade.
          </p>
        </section>

        <h2>Descrição</h2>
        <p>{{ property.description || 'Sem descrição disponível.' }}</p>

        <h2>Características</h2>
        <div class="features">
          <div *ngIf="property.type"><strong>Tipo do imovel</strong><br><span>{{ property.type }}</span></div>
          <div *ngIf="property.bedrooms"><strong>Quartos</strong><br><span>{{ property.bedrooms }}</span></div>
          <div *ngIf="property.bathrooms"><strong>Banheiros</strong><br><span>{{ property.bathrooms }}</span></div>
          <div *ngIf="property.area"><strong>Área</strong><br><span>{{ property.area }} m²</span></div>
          <div *ngIf="property.parking"><strong>Vagas</strong><br><span>{{ property.parking }}</span></div>
        </div>

        <div *ngIf="property.latitude && property.longitude" class="map-section">
          <h2>Localização</h2>
          <div id="property-map" class="map"></div>
          <a [href]="getMapsLink()" target="_blank" class="btn-secondary">
            Abrir no Google Maps
          </a>
        </div>
      </main>

      <!-- SIDEBAR -->
      <aside class="sidebar">
        <div class="contact-box">
          <h3>Gostou deste imóvel?</h3>

          <p class="contact-text">
            Fale diretamente com um corretor local e receba todas as informações
            com transparência.
          </p>

          <a [href]="getWhatsAppLink()" target="_blank" class="btn-whatsapp">
            <i class="fab fa-whatsapp"></i>
            Agendar visita no WhatsApp
          </a>

          <ul class="trust-list">
            <li><i class="fas fa-check"></i> Documentação verificada</li>
            <li><i class="fas fa-check"></i> Atendimento humano</li>
            <li><i class="fas fa-check"></i> Sem compromisso</li>
          </ul>
        </div>
        <div class="quick-actions">
          <button class="action-btn whatsapp" (click)="shareWhatsApp()">
            <i class="fab fa-whatsapp"></i>
            <span>WhatsApp</span>
          </button>
          
          
          <button class="action-btn share" (click)="shareProperty()">
            <i class="fas fa-share-alt"></i>
            <span>Compartilhar</span>
          </button>
        </div>

      </aside>

    </div>
  </div>
</div>


<div
  class="image-viewer"
  *ngIf="isImageViewerOpen"
  (click)="closeImageViewer()"
>
  <img
    class="viewer-image"
    [src]="viewerImage"
    (click)="$event.stopPropagation()"
  />

  <button class="close-btn" (click)="closeImageViewer()">×</button>
</div>
