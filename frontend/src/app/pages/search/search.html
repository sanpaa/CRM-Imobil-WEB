<!-- SEARCH HERO -->
<section class="search-hero p-4">
  <div class="container">
    <h1>Encontre o Imóvel Ideal</h1>
    <p>Use os filtros para refinar sua busca</p>
  </div>
</section>

<!-- SEARCH LAYOUT -->
<div class="search-layout container mb-5" style="max-width: 1500px;">

  <!-- FILTER SIDEBAR -->
  <aside class="filters-sidebar">

    <h2><i class="fas fa-filter"></i> Filtros</h2>

    <!-- Busca livre -->
    <div class="filter-group">
      <label>Busca livre</label>
      <input
        type="text"
        [(ngModel)]="filters.searchText"
        (keyup.enter)="applyFilters()"
        placeholder="Título, bairro, descrição..." />
    </div>

    <!-- Tipo -->
    <div class="filter-group">
      <label>Tipo</label>
      <app-custom-dropdown
        label="{{ filters.type || 'Todos' }}"
        icon="fas fa-home"
        [value]="filters.type"
        [items]="[
          { label: 'Todos', value: '' },
          { label: 'Casa', value: 'Casa' },
          { label: 'Apartamento', value: 'Apartamento' },
          { label: 'Terreno', value: 'Terreno' }
        ]"
        (valueChange)="filters.type = $event; applyFilters()">
      </app-custom-dropdown>
    </div>

    <!-- Quartos -->
    <div class="filter-group">
      <label>Quartos</label>
      <app-custom-dropdown
        label="{{ filters.bedrooms ? filters.bedrooms + '+' : 'Qualquer' }}"
        icon="fas fa-bed"
        [value]="filters.bedrooms"
        [items]="[
          { label: 'Qualquer', value: undefined },
          { label: '1+', value: 1 },
          { label: '2+', value: 2 },
          { label: '3+', value: 3 }
        ]"
        (valueChange)="filters.bedrooms = $event; applyFilters()">
      </app-custom-dropdown>
    </div>

    <!-- Preço -->
    <div class="filter-group">
      <label>Preço mínimo</label>
      <input type="number" [(ngModel)]="filters.priceMin" (keyup.enter)="applyFilters()"placeholder="R$ 0">
    </div>

    <div class="filter-group">
      <label>Preço máximo</label>
      <input type="number" [(ngModel)]="filters.priceMax" (keyup.enter)="applyFilters()" placeholder="Sem limite">
    </div>

    <!-- Ações -->
    <div class="filter-actions">
      <button class="btn primary" (click)="applyFilters()">
        <i class="fas fa-search"></i> Buscar
      </button>
      <button class="btn secondary" (click)="clearFilters()">
        Limpar
      </button>
    </div>

  </aside>

  <!-- RESULTS AREA -->
  <main class="results-area">

    <!-- HEADER -->
    <div class="results-header">
      <span class="results-count">{{ resultsCount }}</span>

      <div class="view-toggle">
        <button
          [class.active]="currentView === 'grid'"
          (click)="switchView('grid')">
          <i class="fas fa-th"></i>
        </button>

        <button
          [class.active]="currentView === 'map'"
          (click)="switchView('map')">
          <i class="fas fa-map"></i>
        </button>
      </div>
    </div>

    <!-- LOADING OVERLAY (NÃO REMOVE DOM) -->
    <div class="loading-overlay" *ngIf="loading">
      <div class="spinner"></div>
      <p>Carregando imóveis...</p>
    </div>

    <!-- MAP VIEW (SEMPRE NO DOM) -->
    <div class="map-wrapper" [hidden]="currentView !== 'map'">
      <div id="map"></div>
    </div>

    <!-- GRID VIEW -->
    <div class="properties-grid" [hidden]="currentView !== 'grid'">
      <app-property-card
        *ngFor="let property of displayedProperties"
        [property]="property">
      </app-property-card>
    </div>

    <!-- NO RESULTS -->
    <div *ngIf="!loading && displayedProperties.length === 0" class="no-results">
      <i class="fas fa-search"></i>
      <h3>Nenhum imóvel encontrado</h3>
      <p>Tente ajustar os filtros</p>
    </div>

    <!-- PAGINATION -->
    <div class="pagination" *ngIf="totalPages > 1 && currentView === 'grid'">

      <button
        class="page-btn"
        [disabled]="currentPage === 1"
        (click)="changePage(currentPage - 1)">
        ‹ Anterior
      </button>

      <button
        *ngFor="let page of paginationPages"
        class="page-btn"
        [class.active]="page === currentPage"
        [disabled]="page === -1"
        (click)="page !== -1 && changePage(page)">
        {{ page === -1 ? '...' : page }}
      </button>

      <button
        class="page-btn"
        [disabled]="currentPage === totalPages"
        (click)="changePage(currentPage + 1)">
        Próxima ›
      </button>

    </div>

  </main>

</div>
